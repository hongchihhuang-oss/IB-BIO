<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IB Bio Master Suite | AI Visual Hub</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        :root { --primary: #2563eb; --bg: #f8fafc; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg); 
            color: #1e293b; 
            overscroll-behavior: none;
        }
        .app-container {
            min-height: 100vh;
            width: 100%;
            max-width: 900px; 
            margin: 0 auto;
            background: white;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 100px rgba(0,0,0,0.08);
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .glass-nav { 
            background: rgba(255, 255, 255, 0.96); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); 
            border-top: 1px solid rgba(0,0,0,0.08);
        }
        .diagnostic-card { border-left-width: 12px; }
        .model-answer-card { background: linear-gradient(135deg, #f0f9ff 0%, #ffffff 100%); border: 1px solid #bae6fd; }
        .nav-active { color: #2563eb; background: #eff6ff; }
        
        button:active { transform: scale(0.97); transition: 0.1s; }
        .mcq-option { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Fixed UI labels that don't scale aggressively */
        .ui-label { font-size: 0.7rem !important; font-weight: 800; text-transform: uppercase; color: #94a3b8; letter-spacing: 0.05em; line-height: 1.2 !important; }
        .content-area { line-height: 1.6; }
        .faded-q { opacity: 0.4; filter: grayscale(1); }
        
        .stat-card { background: white; border: 1px solid #f1f5f9; border-radius: 2rem; padding: 1.5rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, ReactFragment } = React;

        /**
         * Robust BioIcon Component
         * Uses inline SVG fragments to guarantee stability in the Canvas environment.
         */
        const BioIcon = ({ name, size = 24, className = "" }) => {
            const icons = {
                Home: <React.Fragment><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></React.Fragment>,
                Exam: <React.Fragment><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></React.Fragment>,
                Config: <React.Fragment><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1V13a2 2 0 0 1-2-2 2 2 0 0 1 2-2v-.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"/></React.Fragment>,
                Check: <polyline points="20 6 9 17 4 12" />,
                X: <React.Fragment><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></React.Fragment>,
                Dna: <React.Fragment><path d="m8 8 8 8"/><path d="m8 16 8-8"/><circle cx="8" cy="8" r="2"/><circle cx="16" cy="16" r="2"/><circle cx="8" cy="16" r="2"/><circle cx="16" cy="8" r="2"/></React.Fragment>,
                Layers: <React.Fragment><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></React.Fragment>,
                Zap: <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />,
                Refresh: <React.Fragment><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></React.Fragment>
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || icons.Home}
                </svg>
            );
        };

        const THEMES = [
            { id: "A", name: "Unity & Diversity", icon: "Dna" },
            { id: "B", name: "Form & Function", icon: "Layers" },
            { id: "C", name: "Interaction", icon: "Zap" },
            { id: "D", name: "Continuity & Change", icon: "Refresh" }
        ];

        const INITIAL_POOL = {
            A: [{ id: "A1", theme: "A", type: 'MCQ', question: "Which property of water allows organisms to maintain stable body temperatures through evaporation?", options: { A: "Specific heat capacity", B: "Latent heat of vaporization", C: "Cohesion", D: "Density" }, answer: "B", explanation: "Large amounts of energy are required to break the hydrogen bonds in water for it to change from liquid to gas." }],
            B: [{ id: "B1", theme: "B", type: 'ERQ', question: "Explain how the structure of the villus is adapted for efficient absorption of nutrients. (6 marks)" }],
            C: [{ id: "C1", theme: "C", type: 'MCQ', question: "How does a non-competitive inhibitor affect the Vmax of an enzyme-catalyzed reaction?", options: { A: "Increases Vmax", B: "Decreases Vmax", C: "No effect on Vmax", D: "Shifts Km only" }, answer: "B", explanation: "Non-competitive inhibitors change the enzyme's shape, reducing its overall catalytic capacity regardless of substrate concentration." }],
            D: [{ id: "D1", theme: "D", type: 'ERQ', question: "Describe the role of natural selection as a mechanism for evolution. (7 marks)" }]
        };

        const App = () => {
            const [tab, setTab] = useState('home');
            const [apiKey, setApiKey] = useState(localStorage.getItem('gemini_api_key') || '');
            const [globalFontSize, setGlobalFontSize] = useState(Number(localStorage.getItem('app_font_size')) || 18);

            // Statistics management
            const [stats, setStats] = useState(() => {
                const saved = localStorage.getItem('app_stats_v9');
                const def = { total: 0, mcqCorrect: 0, mcqTotal: 0, erqTotal: 0, themes: { A: 0, B: 0, C: 0, D: 0 } };
                if (!saved) return def;
                try { return { ...def, ...JSON.parse(saved) }; } catch(e) { return def; }
            });

            // Quiz engine states
            const [quizStep, setQuizStep] = useState('setup'); 
            const [selThemes, setSelThemes] = useState(['A']); 
            const [selType, setSelType] = useState('MCQ'); 
            const [localPool, setLocalPool] = useState(INITIAL_POOL);
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [userAnswer, setUserAnswer] = useState('');
            const [aiFeedback, setAiFeedback] = useState('');
            const [mcqResult, setMcqResult] = useState(null);
            const [deepInsight, setDeepInsight] = useState('');
            const [loading, setLoading] = useState(false);

            useEffect(() => { localStorage.setItem('app_font_size', globalFontSize.toString()); }, [globalFontSize]);
            useEffect(() => { localStorage.setItem('app_stats_v9', JSON.stringify(stats)); }, [stats]);

            const askAI = async (prompt, system, isJson = false) => {
                if (!apiKey) return "ERROR: API Key missing.";
                const model = "gemini-2.5-flash-preview-09-2025";
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: system }] },
                            generationConfig: isJson ? { responseMimeType: "application/json" } : {}
                        })
                    });
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "AI error.";
                } catch (e) { return "System busy."; }
            };

            const refillPool = async (themeId, type) => {
                const prompt = `Generate ONE advanced IB Bio 2025 question for Theme ${themeId}. JSON format: { "id": "${Date.now()}", "theme": "${themeId}", "type": "${type}", "question": "...", "options": {"A": "...", "B": "...", "C": "...", "D": "..."}, "answer": "A/B/C/D", "explanation": "..." }`;
                try {
                    const res = await askAI(prompt, "IB Bio Q-Bank. JSON only.", true);
                    const parsed = JSON.parse(res);
                    setLocalPool(prev => {
                        const next = { ...prev };
                        next[themeId] = [...(next[themeId] || []), parsed];
                        return next;
                    });
                } catch (e) {}
            };

            const handleTabChange = (newTab) => {
                if (newTab === 'quiz') {
                    setQuizStep('setup');
                    setUserAnswer(''); setAiFeedback(''); setMcqResult(null); setDeepInsight('');
                }
                setTab(newTab);
            };

            const startAssessment = () => {
                const combined = selThemes.flatMap(t => localPool[t] || []).filter(q => q.type === selType);
                if (combined.length > 0) {
                    const picked = combined[Math.floor(Math.random() * combined.length)];
                    setCurrentQuestion(picked);
                    setUserAnswer(''); setAiFeedback(''); setMcqResult(null); setDeepInsight('');
                    setQuizStep('asking');
                } else {
                    setQuizStep('loading');
                    refillPool(selThemes[0], selType).then(() => setQuizStep('setup'));
                }
            };

            const handleMcqSelect = (choice) => {
                const isCorrect = choice === currentQuestion.answer;
                setUserAnswer(choice);
                setMcqResult({ isCorrect, correctAnswer: currentQuestion.answer, explanation: currentQuestion.explanation });
                setQuizStep('mcq_feedback');
                
                setStats(prev => ({
                    ...prev,
                    total: prev.total + 1,
                    mcqTotal: prev.mcqTotal + 1,
                    mcqCorrect: isCorrect ? prev.mcqCorrect + 1 : prev.mcqCorrect,
                    themes: { ...prev.themes, [currentQuestion.theme]: (prev.themes[currentQuestion.theme] || 0) + 1 }
                }));
                refillPool(currentQuestion.theme, 'MCQ');
            };

            const submitErqAnswer = async () => {
                setLoading(true); setQuizStep('grading');
                const prompt = `Question: "${currentQuestion.question}"\nStudent Answer: "${userAnswer}"\n\nGrade for IB 2025 HL. Structure with: ### Final Marks, ### Marking Points Met, ### Critical Diagnostic, ### Level 7 Advice, ### Level 7 Model Answer Example. Professional academic English.`;
                const fb = await askAI(prompt, "Chief IB Moderator.");
                setAiFeedback(fb); setQuizStep('erq_feedback');
                setLoading(false);
                
                setStats(prev => ({
                    ...prev,
                    total: prev.total + 1,
                    erqTotal: prev.erqTotal + 1,
                    themes: { ...prev.themes, [currentQuestion.theme]: (prev.themes[currentQuestion.theme] || 0) + 1 }
                }));
                refillPool(currentQuestion.theme, 'ERQ');
            };

            const requestDeepInsight = async () => {
                setLoading(true);
                const prompt = `Topic: "${currentQuestion.question}". Answer: ${currentQuestion.answer}. Provide pedagogical biology breakdown for 2025 syllabus.`;
                const res = await askAI(prompt, "Senior IB Specialist.");
                setDeepInsight(res);
                setLoading(false);
            };

            const handleNext = () => {
                setLocalPool(prev => {
                    const next = { ...prev };
                    if (currentQuestion) next[currentQuestion.theme] = next[currentQuestion.theme].filter(q => q.id !== currentQuestion.id);
                    return next;
                });
                startAssessment();
            };

            const toggleTheme = (id) => setSelThemes(p => p.includes(id) ? (p.length > 1 ? p.filter(v => v !== id) : p) : [...p, id]);

            return (
                <div className="app-container" style={{ fontSize: `${globalFontSize}px` }}>
                    
                    <header className="p-8 pt-12 flex justify-center bg-white sticky top-0 z-50 border-b border-slate-100">
                        <div className="flex flex-col items-center">
                            <h1 className="font-extrabold text-slate-900 italic" style={{ fontSize: '26px' }}>IB BIO HUB</h1>
                            <div className="text-blue-600 font-black uppercase tracking-widest" style={{ fontSize: '9px' }}>AI Analytics Dashboard</div>
                        </div>
                    </header>

                    <main className="flex-1 p-8 overflow-y-auto hide-scrollbar pb-32 content-area">
                        
                        {tab === 'home' && (
                            <div className="space-y-10 animate-in fade-in">
                                <div className="bg-slate-900 rounded-[3rem] p-12 text-white shadow-2xl relative overflow-hidden">
                                    <div className="absolute -top-16 -right-16 opacity-5 bg-white w-64 h-64 rounded-full blur-3xl"></div>
                                    <div className="relative z-10">
                                        <h2 className="font-black italic mb-4" style={{ fontSize: '36px' }}>Learning Record</h2>
                                        <div className="grid grid-cols-2 gap-4 mb-8 text-center">
                                            <div className="bg-white/5 p-6 rounded-3xl border border-white/10">
                                                <p className="text-blue-400 font-black" style={{ fontSize: '28px' }}>{stats.total}</p>
                                                <p className="ui-label">Completed</p>
                                            </div>
                                            <div className="bg-white/5 p-6 rounded-3xl border border-white/10">
                                                <p className="text-green-400 font-black" style={{ fontSize: '28px' }}>{stats.mcqTotal > 0 ? Math.round((stats.mcqCorrect / stats.mcqTotal) * 100) : 0}%</p>
                                                <p className="ui-label">Accuracy</p>
                                            </div>
                                        </div>
                                        <div className="space-y-3">
                                            {THEMES.map(t => (
                                                <div key={t.id} className="flex items-center justify-between bg-white/5 p-4 rounded-2xl border border-white/10">
                                                    <div className="flex items-center gap-3">
                                                        <BioIcon name={t.icon} size={20} className="text-blue-400" />
                                                        <span className="font-bold text-slate-300 text-sm">{t.name}</span>
                                                    </div>
                                                    <span className="text-[10px] font-black text-blue-400 bg-blue-400/10 px-3 py-1 rounded-full">Count: {stats.themes[t.id] || 0}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {tab === 'quiz' && (
                            <div className="space-y-10 animate-in fade-in">
                                {quizStep === 'setup' && (
                                    <div className="space-y-10 animate-in slide-in-from-bottom-4">
                                        <div className="space-y-6">
                                            <p className="ui-label text-center">Configuration</p>
                                            <div className="grid grid-cols-2 gap-4">
                                                {THEMES.map(t => (
                                                    <button key={t.id} onClick={() => toggleTheme(t.id)} className={`p-6 rounded-[2.5rem] text-left border-2 flex flex-col gap-4 transition-all ${selThemes.includes(t.id) ? 'border-blue-600 bg-blue-50' : 'border-slate-100 bg-slate-50 text-slate-400'}`}>
                                                        <span className="font-black text-lg">{t.name}</span>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="flex gap-4">
                                            {['MCQ', 'ERQ'].map(type => (
                                                <button key={type} onClick={() => setSelType(type)} className={`flex-1 py-5 rounded-2xl font-black border-2 transition-all ${selType === type ? 'border-blue-600 bg-blue-600 text-white shadow-lg' : 'bg-slate-50 text-slate-400'}`}>{type}</button>
                                            ))}
                                        </div>
                                        <button onClick={startAssessment} className="w-full bg-slate-900 text-white py-8 rounded-[3rem] font-black text-2xl uppercase italic shadow-xl">Launch Session</button>
                                    </div>
                                )}

                                {quizStep === 'asking' && (
                                    <div className="bg-white p-12 rounded-[4rem] border border-slate-100 shadow-xl relative animate-in zoom-in-95">
                                        <div className="bg-blue-600 text-white px-8 py-3 rounded-full text-[10px] font-black absolute top-8 right-10 uppercase italic">Active Stream</div>
                                        <div className="text-slate-900 font-extrabold leading-relaxed mb-12 pt-20 border-l-[12px] border-blue-600 pl-12 pr-4 italic" style={{ fontSize: `${globalFontSize + 4}px` }}>{currentQuestion?.question}</div>
                                        {selType === 'MCQ' ? (
                                            <div className="grid grid-cols-1 gap-6">
                                                {Object.entries(currentQuestion?.options || {}).map(([key, val]) => (
                                                    <button key={key} onClick={() => handleMcqSelect(key)} className="p-10 rounded-[2.5rem] font-bold border-4 text-left border-slate-50 bg-slate-50 text-slate-500 active:border-blue-600 active:bg-blue-50 mcq-option" style={{ fontSize: `${globalFontSize}px` }}>
                                                        <span className="w-12 h-12 shrink-0 rounded-full flex items-center justify-center font-black bg-slate-200 text-slate-400 mr-6 inline-flex" style={{ fontSize: '16px' }}>{key}</span>
                                                        <span className="flex-1">{val}</span>
                                                    </button>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="space-y-8">
                                                <textarea className="w-full p-10 bg-slate-50 rounded-[3rem] min-h-[400px] outline-none focus:ring-8 ring-blue-100 font-medium text-slate-700 leading-loose" style={{ fontSize: `${globalFontSize}px` }} placeholder="Draft scientific argument..." value={userAnswer} onChange={(e) => setUserAnswer(e.target.value)} />
                                                <div className="flex gap-4">
                                                    <button onClick={() => setQuizStep('setup')} className="flex-1 bg-slate-50 text-slate-400 py-8 rounded-[2.5rem] font-black text-lg">Abort</button>
                                                    <button onClick={submitErqAnswer} disabled={!userAnswer.trim()} className="flex-[2] bg-slate-900 text-white py-8 rounded-[2.5rem] font-black text-2xl shadow-2xl">Analyze Submission</button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {quizStep === 'grading' && (
                                    <div className="py-40 flex flex-col items-center animate-pulse"><p className="font-black text-4xl italic uppercase">Analyzing Submission...</p></div>
                                )}

                                {quizStep === 'mcq_feedback' && (
                                    <div className="space-y-10 animate-in zoom-in-95 pb-20">
                                        <div className="bg-white p-12 rounded-[4rem] border border-slate-100 shadow-xl relative overflow-hidden">
                                            <div className="text-slate-900 font-extrabold leading-relaxed mb-12 pt-10 border-l-[12px] border-slate-200 pl-12 pr-4 italic faded-q" style={{ fontSize: `${globalFontSize}px` }}>{currentQuestion?.question}</div>
                                            
                                            <div className="grid grid-cols-1 gap-6 mb-12">
                                                {Object.entries(currentQuestion?.options || {}).map(([key, val]) => {
                                                    const isCorrect = key === currentQuestion.answer;
                                                    const isUserChoice = key === userAnswer;
                                                    let colorStyle = "border-slate-50 bg-slate-50 text-slate-400 opacity-60";
                                                    if (isCorrect) colorStyle = "border-green-500 bg-green-50 text-green-900 shadow-md scale-[1.01]";
                                                    else if (isUserChoice) colorStyle = "border-red-500 bg-red-50 text-red-900 shadow-md";

                                                    return (
                                                        <div key={key} className={`p-8 rounded-[2.5rem] font-bold border-4 flex items-center gap-6 ${colorStyle}`} style={{ fontSize: `${globalFontSize}px` }}>
                                                            <span className={`w-10 h-10 shrink-0 rounded-full flex items-center justify-center font-black ${isCorrect ? 'bg-green-600 text-white' : (isUserChoice ? 'bg-red-600 text-white' : 'bg-slate-200')}`} style={{ fontSize: '14px' }}>{key}</span>
                                                            <span className="flex-1">{val}</span>
                                                            {isCorrect && <BioIcon name="Check" size={20} className="text-green-600" />}
                                                            {isUserChoice && !isCorrect && <BioIcon name="X" size={20} className="text-red-600" />}
                                                        </div>
                                                    );
                                                })}
                                            </div>

                                            <div className="p-10 rounded-[3.5rem] border-l-[15px] shadow-sm bg-indigo-50 border-indigo-400 text-indigo-900 mb-6">
                                                <div className="flex justify-between items-center mb-6">
                                                    <div className="font-black uppercase italic" style={{ fontSize: `${globalFontSize + 4}px` }}>Expert Explanation</div>
                                                    {!deepInsight && <button onClick={requestDeepInsight} className="bg-blue-600 text-white text-xs px-5 py-2 rounded-full font-black animate-pulse">Deep Analysis +</button>}
                                                </div>
                                                <div className="font-medium opacity-95 content-area" style={{ fontSize: `${globalFontSize}px` }}>{currentQuestion.explanation}</div>
                                                {deepInsight && <div className="mt-8 pt-8 border-t border-indigo-200 text-indigo-800 font-bold content-area">{deepInsight}</div>}
                                            </div>
                                        </div>
                                        <button onClick={handleNext} className="w-full bg-slate-900 text-white py-8 rounded-[3rem] font-black text-2xl uppercase shadow-2xl flex items-center justify-center gap-6 italic tracking-widest">Continue Practice <BioIcon name="Check" size={32}/></button>
                                    </div>
                                )}

                                {quizStep === 'erq_feedback' && (
                                    <div className="space-y-8 animate-in zoom-in-95 pb-20">
                                        <div className="space-y-8">
                                            {String(aiFeedback).split('###').filter(s => s.trim()).map((sec, idx) => {
                                                const lines = sec.trim().split('\n');
                                                const title = lines[0].trim();
                                                const body = lines.slice(1).join('\n');
                                                let style = "bg-slate-50 border-slate-200 text-slate-900";
                                                if (title.toLowerCase().includes('marks')) style = "bg-indigo-50 border-indigo-400 text-indigo-900";
                                                if (title.toLowerCase().includes('points')) style = "bg-green-50 border-green-400 text-green-900";
                                                if (title.toLowerCase().includes('diag') || title.toLowerCase().includes('critique')) style = "bg-orange-50 border-orange-400 text-orange-900";
                                                if (title.toLowerCase().includes('model') || title.toLowerCase().includes('level 7')) style = "model-answer-card border-blue-600 text-blue-900 shadow-xl";

                                                return (
                                                    <div key={idx} className={`p-10 rounded-[3.5rem] border-l-[15px] shadow-sm ${style}`}>
                                                        <div className="font-black uppercase italic mb-6" style={{ fontSize: `${globalFontSize + 6}px` }}>{title}</div>
                                                        <div className="font-medium whitespace-pre-wrap opacity-90 content-area" style={{ fontSize: `${globalFontSize}px` }}>{body.replace(/[*#]/g, '').trim()}</div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        <button onClick={handleNext} className="w-full bg-slate-900 text-white py-8 rounded-[3rem] font-black text-2xl uppercase shadow-2xl flex items-center justify-center gap-6 italic tracking-widest">Next Paper</button>
                                    </div>
                                )}
                            </div>
                        )}

                        {tab === 'config' && (
                            <div className="bg-white p-12 rounded-[4rem] border border-slate-100 shadow-sm space-y-12 animate-in zoom-in-95">
                                <h2 className="text-3xl font-black italic uppercase text-center" style={{ fontSize: '32px' }}>Settings</h2>
                                
                                <div className="space-y-8 p-10 bg-slate-50 rounded-[3rem] border border-slate-200">
                                    <p className="ui-label mb-4">Reading Environment</p>
                                    <div className="flex items-center justify-between">
                                        <span className="font-bold text-xl">App Font Size: {globalFontSize}px</span>
                                        <div className="flex gap-4">
                                            <button onClick={() => setGlobalFontSize(v => Math.max(14, v - 2))} className="w-16 h-16 rounded-2xl bg-white border-2 border-slate-200 flex items-center justify-center text-2xl font-black active:bg-blue-600 active:text-white transition-all shadow-sm">A-</button>
                                            <button onClick={() => setGlobalFontSize(v => Math.min(32, v + 2))} className="w-16 h-16 rounded-2xl bg-white border-2 border-slate-200 flex items-center justify-center text-2xl font-black active:bg-blue-600 active:text-white transition-all shadow-sm">A+</button>
                                        </div>
                                    </div>
                                    <p className="text-slate-400 text-[10px] mt-4 italic leading-relaxed">Adjust font size for your study comfort. Settings persist across sessions.</p>
                                </div>

                                <div className="space-y-6">
                                    <label className="ui-label ml-4">Gemini Pro API Key</label>
                                    <input type="password" className="w-full p-10 bg-slate-50 border-4 border-slate-100 rounded-[2.5rem] font-bold text-2xl shadow-inner outline-none focus:border-blue-600" value={apiKey} onChange={(e) => { setApiKey(e.target.value); localStorage.setItem('gemini_api_key', e.target.value); }} />
                                    <div className="p-8 bg-blue-50/50 rounded-3xl border-2 border-blue-100/30 flex gap-6 items-start"><p className="text-sm text-slate-500 italic leading-snug tracking-tight">Security: Your key is stored in your <strong className="text-slate-900 underline decoration-blue-500">Local Browser Storage</strong>. Never uploaded to servers.</p></div>
                                </div>
                            </div>
                        )}

                    </main>

                    {/* Navigation */}
                    <nav className="fixed bottom-10 left-1/2 -translate-x-1/2 w-[94%] max-w-[650px] glass-nav rounded-[4rem] p-4 flex justify-around shadow-2xl z-50 border border-white/50">
                        <button onClick={() => handleTabChange('home')} className={`flex flex-col items-center justify-center gap-2 px-10 py-4 rounded-[3rem] transition-all duration-300 ${tab === 'home' ? 'nav-active shadow-inner' : 'text-slate-400'}`}>
                            <BioIcon name="Home" size={28} />
                            <span className="text-[10px] font-black uppercase tracking-widest">Dashboard</span>
                        </button>
                        <button onClick={() => handleTabChange('quiz')} className={`flex flex-col items-center justify-center gap-2 px-10 py-4 rounded-[3rem] transition-all duration-300 ${tab === 'quiz' ? 'nav-active shadow-inner' : 'text-slate-400'}`}>
                            <BioIcon name="Exam" size={28} />
                            <span className="text-[10px] font-black uppercase tracking-widest">Practice</span>
                        </button>
                        <button onClick={() => handleTabChange('config')} className={`flex flex-col items-center justify-center gap-2 px-10 py-4 rounded-[3rem] transition-all duration-300 ${tab === 'config' ? 'nav-active shadow-inner' : 'text-slate-400'}`}>
                            <BioIcon name="Config" size={28} />
                            <span className="text-[10px] font-black uppercase tracking-widest">Settings</span>
                        </button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
